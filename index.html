<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>MPIK Dynamic Webpage Editor â€” Improved</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        

* {
    box-sizing: border-box;
}

.container {
    height: 100vh;
    background-color: skyblue;
    color: White;
    padding: 2rem;
    display: flex;
    justify-content: center;
    align-items: center;
}

#leftbox,
#rightbox {
    height: 50vh;
    width: 45vh;
    margin: 0.5rem;
    border: 2px dashed;
    position: relative;
    /* important for absolute children */
}

.lists {
    text-align: center;
    padding: 1rem;
    margin: 0.5rem;
    border: 2px solid white;
    background-color: white;
    color: black;
    position: absolute;
    /* allow free placement */
}

.resize-handle {
    width: 10px;
    height: 10px;
    background: red;
    position: absolute;
    right: 0;
    bottom: 0;
    cursor: se-resize;
}
    </style>
</head>

<body>
    
    <div class="container">
        <div id="leftbox"></div>
        <div id="rightbox">
            <div class="lists" draggable="true">List Item 1</div>
            <div class="lists" draggable="true">List Item 2</div>
            <div class="lists" draggable="true">List Item 3</div>
            <div class="lists" draggable="true">List Item 4</div>
        </div>
    </div>

    <script type="module">
        /*
  MPIK Dynamic Webpage Editor - robust version
  - Defensive checks to avoid runtime errors when required DOM nodes are missing
  - Preserves original behaviour and event wiring
  - Keep your existing HTML IDs / templates; if any are missing, script will warn (console) but continue
*/

        let items = document.getElementsByClassName('lists');
let rightBox = document.getElementById('rightbox');
let leftBox = document.getElementById('leftbox');
let selectedItem = null;

for (let item of Array.from(items)) {
    item.addEventListener("dragstart", function(e) {
        selectedItem = e.target;
    });
}

function enableTextEditing(el) {
    el.addEventListener("dblclick", () => {
        el.setAttribute("contenteditable", "true");
        el.focus();
        el.addEventListener("blur", () => {
            el.removeAttribute("contenteditable");
        }, {
            once: true
        });
    });
}

function makeResizable(el) {
    let handle = document.createElement("div");
    handle.className = "resize-handle";
    el.appendChild(handle);

    handle.addEventListener("mousedown", e => {
        e.preventDefault();
        let startX = e.clientX;
        let startY = e.clientY;
        let startWidth = parseInt(getComputedStyle(el).width, 10);
        let startHeight = parseInt(getComputedStyle(el).height, 10);

        function doDrag(e) {
            el.style.width = (startWidth + e.clientX - startX) + "px";
            el.style.height = (startHeight + e.clientY - startY) + "px";
        }

        function stopDrag() {
            document.removeEventListener("mousemove", doDrag);
            document.removeEventListener("mouseup", stopDrag);
        }

        document.addEventListener("mousemove", doDrag);
        document.addEventListener("mouseup", stopDrag);
    });
}

function addItemFeatures(el) {
    enableTextEditing(el);
    makeResizable(el);
}

function dropInBox(box, e) {
    if (selectedItem) {
        let clone = selectedItem.cloneNode(true); // keep original intact
        let rect = box.getBoundingClientRect();

        // calculate position relative to container
        let x = e.clientX - rect.left;
        let y = e.clientY - rect.top;

        clone.style.left = x + "px";
        clone.style.top = y + "px";

        box.appendChild(clone);
        addItemFeatures(clone);
        selectedItem = null;
    }
}

rightBox.addEventListener("dragover", e => e.preventDefault());
leftBox.addEventListener("dragover", e => e.preventDefault());

rightBox.addEventListener("drop", e => dropInBox(rightBox, e));
leftBox.addEventListener("drop", e => dropInBox(leftBox, e));
    </script>

</body>

</html>